<!DOCTYPE html>
<html>
<head>




<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
<meta name="generator" content="Orchid 0.16.4"/>
<link rel="icon" href="https://copper-leaf.github.io/trellis/favicon.ico">


<meta name="robots" content="index, follow">



<title>Numeric Logic</title>


<meta name="description" content="A Kotlin implementation of the Specification Pattern">



<link rel="prev" href="https://copper-leaf.github.io/trellis/wiki/examples/boolean-logic">



<script>
    window.site = {"orchidVersion":"0.16.4","baseUrl":"https://copper-leaf.github.io/trellis","environment":"prod","version":"0.7.0"};
</script>




<!-- start:inject styles -->
<link rel="stylesheet" type="text/css" href="https://copper-leaf.github.io/trellis/Copper/c5d65685/assets/css/bulma.css"/>
<link rel="stylesheet" type="text/css" href="https://copper-leaf.github.io/trellis/Copper/c5d65685/assets/css/extraCss.css"/>
<link rel="stylesheet" type="text/css" href="https://copper-leaf.github.io/trellis/Copper/c5d65685/assets/css/bulma-tooltip.css"/>
<link rel="stylesheet" type="text/css" href="https://copper-leaf.github.io/trellis/Copper/c5d65685/assets/css/bulma-accordion.min.css"/>
<link rel="stylesheet" type="text/css" href="https://copper-leaf.github.io/trellis/PrismJS/prism-themes/master/themes/prism-duotone-light.css"/>
<!-- end:inject styles -->

</head>
<body>

<div class="columns is-marginless">
  <div class="column is-one-third is-paddingless column-main-left is-hidden-mobile">
  
    <section class="hero is-fullheight is-primary is-bold">
<!-- Hero header: will stick at the top -->
<div class="hero-head">
  <div class="columns is-mobile has-text-centered">
  
    <div class="column">
      <a class="icon is-inline-block" href="https://copper-leaf.github.io/trellis" title="Home">
        <i class="fas fa-home large-social-icon"></i>
      </a>
    </div>
  
    <div class="column">
      <a class="icon is-inline-block" href="https://github.com/copper-leaf/trellis" title="Github">
        <i class="fab fa-github large-social-icon"></i>
      </a>
    </div>
  
    <div class="column">
      <a class="icon is-inline-block" href="https://twitter.com/OrchidSSG" title="Twitter">
        <i class="fab fa-twitter large-social-icon"></i>
      </a>
    </div>
  
  </div>
</div>

<!-- Hero content: will be in the middle -->
<div class="hero-body">
  <div class="container sidebar-menu">

    <div class="sidebar-header-small">
      <figure class="image is-64x64">
        <img src="https://copper-leaf.github.io/trellis/assets/media/theme-logo.png" alt="">
      </figure>
      <h1 class="title is-3 is-spaced has-text-centered">Trellis</h1>
    </div>

    <details class="is-hidden-tablet">
      <summary>
        Menu
      </summary>
      <div id="mobile-sidebar-menu"></div>
    </details>
    <div class="is-hidden-mobile">
      <aside class="menu" id="responsive-menu-content">

      
      
      
        <ul class="menu-list">

<li>
  <a href="https://copper-leaf.github.io/trellis/wiki/overview" class="">Overview</a>
</li>

</ul>
      
      
      
      
        <ul class="menu-list">

<li>
  <a href="https://copper-leaf.github.io/trellis/wiki/installation" class="">Installation</a>
</li>

</ul>
      
      
      
      
      
<ul class="menu-list">

  

<li>
  <a href="https://copper-leaf.github.io/trellis/wiki/features" class="">Features</a>
</li>



  <li>
    <ul>
    
      

<li>
  <a href="https://copper-leaf.github.io/trellis/wiki/features/trellis-core" class="">Trellis Core</a>
</li>


    
      

<li>
  <a href="https://copper-leaf.github.io/trellis/wiki/features/trellis-dsl" class="">Trellis DSL</a>
</li>


    
      

<li>
  <a href="https://copper-leaf.github.io/trellis/wiki/features/java-interop" class="">Java Interop</a>
</li>


    
      

<li>
  <a href="https://copper-leaf.github.io/trellis/wiki/features/introspection" class="">Introspection</a>
</li>


    
    </ul>
  </li>
</ul>

      
      
      
      
      
<ul class="menu-list">

  

<li>
  <a href="https://copper-leaf.github.io/trellis/wiki/examples" class="">Examples</a>
</li>



  <li>
    <ul>
    
      

<li>
  <a href="https://copper-leaf.github.io/trellis/wiki/examples/boolean-logic" class="">Boolean Logic</a>
</li>


    
      

<li>
  <a href="https://copper-leaf.github.io/trellis/wiki/examples/numeric-logic" class="is-active">Numeric Logic</a>
</li>


    
    </ul>
  </li>
</ul>

      
      
      </aside>
    </div>
  </div>
</div>

<script type="text/javascript">
  function copyElem(fromId, toId){
    console.log("copyElem(" + fromId + ", " + toId + ")");
    var fromElementContent = document.getElementById(fromId);
    var toElementContent = document.getElementById(toId);
    toElementContent.outerHTML = fromElementContent.outerHTML;
  }

  document.addEventListener("DOMContentLoaded", function(event) {
    copyElem('responsive-menu-content', 'mobile-sidebar-menu');
  });
</script>

<!-- Hero footer: will stick at the bottom -->
<div class="hero-foot">
  <nav class="tabs is-boxed is-centered">
    <div class="container">
      <ul>
      
        <li class="">
          <a href="https://copper-leaf.github.io/trellis">Home</a>
        </li>
      
        <li class="">
          <a href="https://copper-leaf.github.io/trellis/wiki">Wiki</a>
        </li>
      
        <li class="">
          <a href="https://copper-leaf.github.io/trellis/changelog">Changelog</a>
        </li>
      
      </ul>
    </div>
  </nav>
</div>
</section>
  
  </div>
  <div class="column is-one-third is-paddingless column-main-left is-hidden-tablet">
    <section class="hero is-primary hero-image">
<!-- Hero header: will stick at the top -->
<div class="hero-head">
  <div class="columns is-mobile has-text-centered">
  
    <div class="column">
      <a class="icon is-inline-block" href="https://copper-leaf.github.io/trellis" title="Home">
        <i class="fas fa-home large-social-icon"></i>
      </a>
    </div>
  
    <div class="column">
      <a class="icon is-inline-block" href="https://github.com/copper-leaf/trellis" title="Github">
        <i class="fab fa-github large-social-icon"></i>
      </a>
    </div>
  
    <div class="column">
      <a class="icon is-inline-block" href="https://twitter.com/OrchidSSG" title="Twitter">
        <i class="fab fa-twitter large-social-icon"></i>
      </a>
    </div>
  
  </div>
</div>

<!-- Hero content: will be in the middle -->
<div class="hero-body">
  <div class="container sidebar-menu">

    <div class="sidebar-header-small">
      <figure class="image is-64x64">
        <img src="https://copper-leaf.github.io/trellis/assets/media/theme-logo.png" alt="">
      </figure>
      <h1 class="title is-3 is-spaced has-text-centered">Trellis</h1>
    </div>

    <details class="is-hidden-tablet">
      <summary>
        Menu
      </summary>
      <div id="mobile-sidebar-menu"></div>
    </details>
    <div class="is-hidden-mobile">
      <aside class="menu" id="responsive-menu-content">

      
      
      
        <ul class="menu-list">

<li>
  <a href="https://copper-leaf.github.io/trellis/wiki/overview" class="">Overview</a>
</li>

</ul>
      
      
      
      
        <ul class="menu-list">

<li>
  <a href="https://copper-leaf.github.io/trellis/wiki/installation" class="">Installation</a>
</li>

</ul>
      
      
      
      
      
<ul class="menu-list">

  

<li>
  <a href="https://copper-leaf.github.io/trellis/wiki/features" class="">Features</a>
</li>



  <li>
    <ul>
    
      

<li>
  <a href="https://copper-leaf.github.io/trellis/wiki/features/trellis-core" class="">Trellis Core</a>
</li>


    
      

<li>
  <a href="https://copper-leaf.github.io/trellis/wiki/features/trellis-dsl" class="">Trellis DSL</a>
</li>


    
      

<li>
  <a href="https://copper-leaf.github.io/trellis/wiki/features/java-interop" class="">Java Interop</a>
</li>


    
      

<li>
  <a href="https://copper-leaf.github.io/trellis/wiki/features/introspection" class="">Introspection</a>
</li>


    
    </ul>
  </li>
</ul>

      
      
      
      
      
<ul class="menu-list">

  

<li>
  <a href="https://copper-leaf.github.io/trellis/wiki/examples" class="">Examples</a>
</li>



  <li>
    <ul>
    
      

<li>
  <a href="https://copper-leaf.github.io/trellis/wiki/examples/boolean-logic" class="">Boolean Logic</a>
</li>


    
      

<li>
  <a href="https://copper-leaf.github.io/trellis/wiki/examples/numeric-logic" class="is-active">Numeric Logic</a>
</li>


    
    </ul>
  </li>
</ul>

      
      
      </aside>
    </div>
  </div>
</div>

<script type="text/javascript">
  function copyElem(fromId, toId){
    console.log("copyElem(" + fromId + ", " + toId + ")");
    var fromElementContent = document.getElementById(fromId);
    var toElementContent = document.getElementById(toId);
    toElementContent.outerHTML = fromElementContent.outerHTML;
  }

  document.addEventListener("DOMContentLoaded", function(event) {
    copyElem('responsive-menu-content', 'mobile-sidebar-menu');
  });
</script>

<!-- Hero footer: will stick at the bottom -->
<div class="hero-foot">
  <nav class="tabs is-boxed is-centered">
    <div class="container">
      <ul>
      
        <li class="">
          <a href="https://copper-leaf.github.io/trellis">Home</a>
        </li>
      
        <li class="">
          <a href="https://copper-leaf.github.io/trellis/wiki">Wiki</a>
        </li>
      
        <li class="">
          <a href="https://copper-leaf.github.io/trellis/changelog">Changelog</a>
        </li>
      
      </ul>
    </div>
  </nav>
</div>
</section>
  </div>
  <div class="column is-two-thirds is-paddingless column-main-right">
    <div class="textured">
    
<div class="box">

<nav class="breadcrumb" aria-label="breadcrumbs">
<ul>


    <li><a href="https://copper-leaf.github.io/trellis/wiki">Wiki</a></li>



    <li class="is-active"><a href="https://copper-leaf.github.io/trellis/wiki/examples/numeric-logic" aria-current="page">Numeric Logic</a></li>


</ul>
</nav>


</div>

    
<div class="box">
  <h2 class="title is-1 is-spaced">Numeric Logic</h2>
  <p class="subtitle is-4"></p>
  
    <!-- start:inject components -->
    
        
            
                
                    
                        <div class="content is-medium-tablet is-large-desktop">
<p>Another use-case is computing the value for a user with many branching conditions and complex logic to decide whether
a given condition should be applied. An example is computing the discount for a customer on an online store, which may
factor in customer loyalty, timely promotions, and coupon codes. The computation will look for the greatest possible
discount of all those available, and apply that one at checkout:</p>
<ul>
<li>10% Loyalty discount after 1 year</li>
<li>15% Loyalty discount after 2 years</li>
<li>25% Loyalty discount after 5 years</li>
<li>20% off during August for back-to-school promotion</li>
<li>Additional 10% off for friends and family with coupon code</li>
</ul>
<p>Building such a <code>Spek</code> might look like the following:</p>
<p><strong>Specification Builder</strong></p>
<pre><code class="language-kotlin">val discountSpek = LargestSpek(
        LoyaltyDiscountSpek(discount=0.1, 1),
        LoyaltyDiscountSpek(discount=0.15, 2),
        LoyaltyDiscountSpek(discount=0.25, 5),
        BetweenDatesSpek(LocalDate.of(2018, 8, 1), LocalDate.of(2018, 8, 31))
            .then(
                PromotionDiscount(discount=0.20), // then spek
                ValueSpek(0)                      // else spek
            )
)
.plus(CouponDiscountSpek(discount=0.1, code=&quot;friendsandfamily&quot;))

val discount = discountSpek.evaluate(customer)
checkout(customer, cart, discount)
</code></pre>
<p>Or, using the <a href="https://copper-leaf.github.io/trellis/wiki/features/trellis-dsl">Trellis DSL</a>:</p>
<p><strong>Specification Expression</strong></p>
<pre><code>largest(
  loyalty('0.1', 1),
  loyalty('0.15', 2),
  loyalty('0.25', 5),
  if(
    betweenDates(
      date(2018, 8, 1),
      date(2018, 8, 31)
    ),
    promotion('0.2'),
    '0.0'
  )
) + couponCode('0.1', friendsandfamily)
</code></pre>
<p><strong>Configuration</strong></p>
<pre><code class="language-kotlin">val context = SpekExpressionContext {
    register { cxt, args -&gt;
        val typesafeArgs = args
            .map { it.typeSafe&lt;Any, Any, Any, Number&gt;(cxt) }
            .toTypedArray()
        LargestSpek(*typesafeArgs)
    }
    register(&quot;loyalty&quot;) { cxt, args -&gt;
        LoyaltyDiscountSpek(
            args[0].typeSafe&lt;Any, Any, Any, Double&gt;(cxt),
            args[1].typeSafe&lt;Any, Any, Any, Int&gt;(cxt)
        )
    }
    register(&quot;couponCode&quot;) { cxt, args -&gt;
        CouponDiscountSpek(
            args[0].typeSafe&lt;Any, Any, Any, Double&gt;(cxt),
            args[1].typeSafe&lt;Any, Any, Any, String&gt;(cxt)
        )
    }
    register(&quot;promotion&quot;) { cxt, args -&gt;
        PromotionDiscountSpek(
            args[0].typeSafe&lt;Any, Any, Any, Double&gt;(cxt)
        )
    }
    register(&quot;betweenDates&quot;) { cxt, args -&gt;
        BetweenDatesSpek(
            args[0].typeSafe&lt;Any, Any, Any, LocalDate?&gt;(cxt),
            args[1].typeSafe&lt;Any, Any, Any, LocalDate?&gt;(cxt),
            ValueSpek((cxt as DiscountContext).currentDate)
        )
    }
    register(&quot;date&quot;) { cxt, args -&gt;
        DateSpek(
            args[0].typeSafe&lt;Any, Any, Any, Int&gt;(cxt),
            args[1].typeSafe&lt;Any, Any, Any, Int&gt;(cxt),
            args[2].typeSafe&lt;Any, Any, Any, Int&gt;(cxt)
        )
    }
    register(&quot;if&quot;) { cxt, args -&gt;
        IfSpek(
            args[0].typeSafe&lt;Any, Any, Any, Boolean&gt;(cxt),
            args[1].typeSafe&lt;Any, Any, Any, Any&gt;(cxt),
            args[2].typeSafe&lt;Any, Any, Any, Any&gt;(cxt)
        )
    }
}
val discount = TrellisDsl.evaluate&lt;Discount, Double&gt;(
    context,
    &quot;&quot;&quot;
    |largest(
    |  loyalty('0.1', 1),
    |  loyalty('0.15', 2),
    |  loyalty('0.25', 5),
    |  if(
    |    betweenDates(
    |      date(2018, 8, 1),
    |      date(2018, 8, 31)
    |    ),
    |    promotion('0.2'),
    |    '0.0'
    |  )
    |) + couponCode('0.1', friendsandfamily)
    &quot;&quot;&quot;.trimMargin(),
    customer
)
checkout(customer, cart, discount)
</code></pre>

</div>
                    
                
            
        
            
        
    
    <!-- end:inject components -->


</div>

      <div class="grow"></div>
      <div class="page-footer">
      
<nav class="pagination is-rounded footer-pagination" role="navigation" aria-label="pagination">


  <a class="pagination-previous" href="https://copper-leaf.github.io/trellis/wiki/examples/boolean-logic"><span class="icon"><i class="fas fa-chevron-left"></i></span>Boolean Logic</a>



  <a class="pagination-next" disabled><span class="inner">Next<span class="icon"><i class="fas fa-chevron-right"></i></span></span></a>


</nav>

      
<footer class="footer">
  <div class="content is-small">
    <p>
  &copy;2019 Copper Leaf.
</p>
<p>
  Site proudly built with <a href="https://orchid.netlify.com/">Orchid</a>.<br>
</p>
<p>
  <b>See Also:</b><br>
  <span class="tag is-light"><a href="https://orchid.netlify.com/">Orchid</a></span>
  <span class="tag is-light"><a href="https://javaeden.github.io/Clog/">Clog</a></span>
  <span class="tag is-light"><a href="https://copper-leaf.github.io/krow/">Krow</a></span>
  <span class="tag is-light"><a href="https://copper-leaf.github.io/kudzu/">Kudzu</a></span>
  <span class="tag is-light"><a href="https://copper-leaf.github.io/trellis/">Trellis</a></span>
  <span class="tag is-light"><a href="https://copper-leaf.github.io/dokka-json/">JSON Documentation Formatters</a></span>
</p>
  </div>
</footer>

      </div>
    </div>
  </div>
</div>
<!-- start:inject scripts -->
<script defer src="https://copper-leaf.github.io/trellis/Copper/c5d65685/releases/v5.4.0/js/all.js"></script>
<script src="https://copper-leaf.github.io/trellis/Copper/c5d65685/assets/js/bulma-accordion.min.js"></script>
<script>
bulmaAccordion.attach();
</script>
<script src="https://copper-leaf.github.io/trellis/ajax/libs/prism/1.8.4/prism.min.js"></script>
<script src="https://copper-leaf.github.io/trellis/ajax/libs/prism/1.8.4/components/prism-kotlin.min.js"></script>
<script src="https://copper-leaf.github.io/trellis/ajax/libs/prism/1.8.4/components/prism-java.min.js"></script>
<script src="https://copper-leaf.github.io/trellis/ajax/libs/prism/1.8.4/components/prism-groovy.min.js"></script>
<!-- end:inject scripts -->

</body>
</html>










